<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>iOS Search APIs | Punmy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="iOS 9 ä¹‹åï¼ŒApple å¼€æ”¾äº†ä¸‰å¤§ Search APIsï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½åœ¨ Spotlightã€Safari ç­‰æœç´¢å…¥å£ï¼Œæœç´¢åˆ°åº”ç”¨ä¸­çš„å†…å®¹ï¼Œè¿™ååˆ†æœ‰åŠ©äºæå‡åº”ç”¨çš„ç”¨æˆ·æ´»è·ƒåº¦ã€‚">
<meta name="keywords" content="NSUserActivity,Web Markup,Spotlight,iOS,Search APIs">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS Search APIs">
<meta property="og:url" content="http://punmy.cn/2017/03/06/15158218121366/index.html">
<meta property="og:site_name" content="Punmy">
<meta property="og:description" content="iOS 9 ä¹‹åï¼ŒApple å¼€æ”¾äº†ä¸‰å¤§ Search APIsï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½åœ¨ Spotlightã€Safari ç­‰æœç´¢å…¥å£ï¼Œæœç´¢åˆ°åº”ç”¨ä¸­çš„å†…å®¹ï¼Œè¿™ååˆ†æœ‰åŠ©äºæå‡åº”ç”¨çš„ç”¨æˆ·æ´»è·ƒåº¦ã€‚">
<meta property="og:image" content="http://punmy.cn/media/15158218121366/QQ20170314-163826.png">
<meta property="og:image" content="http://punmy.cn/media/15158218121366/numbers_2x.png">
<meta property="og:image" content="http://punmy.cn/media/15158218121366/QQ20170314-162924@2x.png">
<meta property="og:image" content="http://punmy.cn/media/15158218121366/movie_2x.png">
<meta property="og:image" content="http://punmy.cn/media/15158218121366/apple.png">
<meta property="og:updated_time" content="2018-04-07T10:51:43.747Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS Search APIs">
<meta name="twitter:description" content="iOS 9 ä¹‹åï¼ŒApple å¼€æ”¾äº†ä¸‰å¤§ Search APIsï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½åœ¨ Spotlightã€Safari ç­‰æœç´¢å…¥å£ï¼Œæœç´¢åˆ°åº”ç”¨ä¸­çš„å†…å®¹ï¼Œè¿™ååˆ†æœ‰åŠ©äºæå‡åº”ç”¨çš„ç”¨æˆ·æ´»è·ƒåº¦ã€‚">
<meta name="twitter:image" content="http://punmy.cn/media/15158218121366/QQ20170314-163826.png">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-82197397-1', 'auto');
ga('send', 'pageview');

</script>
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?feda8e6966219ebc3f2c8caf07bcb17b";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Punmy</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.jpg" />
            <h2 id="name">Punmy</h2>
            <h3 id="title">Codes, thoughts and stories.</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Xiamen, China</span>
            <a id="follow" target="_blank" href="https://github.com/panmingyang2009">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                5
                <span>posts</span>
            </div>
            <div class="article-info-block">
                10
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/panmingyang2009" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.facebook.com/myericyoung" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://weibo.com/imericyoung" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-15158218121366" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            iOS Search APIs
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/03/06/15158218121366/">
            <time datetime="2017-03-06T08:40:00.000Z" itemprop="datePublished">2017-03-06</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Code/">Code</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/framework/">framework</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>, <a class="tag-link" href="/tags/åŸºç¡€/">åŸºç¡€</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h2><p>iOS 9 ä¹‹åï¼ŒApple å¼€æ”¾äº†ä¸‰å¤§ Search APIsï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½åœ¨ Spotlightã€Safari ç­‰æœç´¢å…¥å£ï¼Œæœç´¢åˆ°åº”ç”¨ä¸­çš„å†…å®¹ï¼Œè¿™ååˆ†æœ‰åŠ©äºæå‡åº”ç”¨çš„ç”¨æˆ·æ´»è·ƒåº¦ã€‚</p>
<a id="more"></a>
<p><img src="/media/15158218121366/QQ20170314-163826.png" alt="æœç´¢å…¥å£"></p>
<p>è¿™ä¸‰ç»„ Search APIs åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><strong>NSUserActivity</strong>ï¼šèƒ½å¤Ÿä¸ºç”¨æˆ·åœ¨ App ä¸­çš„å†å²æ´»åŠ¨å»ºç«‹ç´¢å¼•ï¼Œä¾‹å¦‚åˆ°è¾¾æŸä¸ªå…³é”®é¡µé¢ï¼Œæˆ–æ˜¯æµè§ˆåˆ°æŸä¸ªå†…å®¹é¡µã€‚ä»¥ä¾¿ä»¥åç”¨æˆ·èƒ½å¤Ÿé€šè¿‡æœç´¢ç»“æœæ¢å¤åˆ°è¯¥é¡µé¢ã€‚</li>
<li><strong>Core Spotlight</strong>ï¼šä¸º App ä¸­çš„ä¸€äº›é‡è¦å†…å®¹ï¼Œåœ¨è®¾å¤‡ä¸Šå»ºç«‹ç´¢å¼•ï¼Œä»¥æä¾›å¿«é€Ÿå…¥å£ã€‚</li>
<li><strong>Web markup</strong>ï¼šå…³è”æœåŠ¡å™¨ä¸Šçš„å†…å®¹åˆ°æœç´¢ç»“æœä¸­ï¼Œç”¨æˆ·å³ä½¿æ²¡æœ‰å®‰è£… Appï¼Œä¹Ÿèƒ½åœ¨æœç´¢ç»“æœä¸­çœ‹åˆ°ç›¸å…³å†…å®¹ã€‚</li>
</ul>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»å‰ä¸¤ç§ API â€”â€” NSUserActivity å’Œ Core Spotlightã€‚</p>
<blockquote>
<p><strong>Note</strong>: è™½ç„¶å…¨å±€æœç´¢ï¼ˆapp searchï¼‰åŠŸèƒ½åœ¨ iOS 9 åå°±å¯ç”¨äº†ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œéƒ¨åˆ†æ—§æœºå‹ä»ç„¶ä¸æ”¯æŒ NSUserActivity å’Œ Core Spotlight çš„æœç´¢åŠŸèƒ½ï¼Œå¦‚ iPhone 4sã€iPad 2ã€iPadï¼ˆç¬¬ä¸‰ä»£ï¼‰ã€iPad miniï¼Œä»¥åŠ iPod touch 5.</p>
</blockquote>
<h2 id="Core-Spotlight"><a href="#Core-Spotlight" class="headerlink" title="Core Spotlight"></a>Core Spotlight</h2><blockquote>
<p>Index App Content</p>
</blockquote>
<p>Core Spotlight ä¸»è¦ç”¨äºä¸º App ä¸­çš„ä¸€äº›é‡è¦å†…å®¹ï¼ˆæ¯”è¾ƒé™æ€ï¼‰ï¼Œåœ¨è®¾å¤‡ä¸Šå»ºç«‹ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨çš„ä¸€äº›å¸¸ç”¨åŠŸèƒ½é¡µé¢ï¼Œä»¥åŠä¸€äº›æ–‡æ¡£ã€éŸ³è§†é¢‘å†…å®¹ï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°è®¿é—®è¿™äº›å¸¸ç”¨å†…å®¹ã€‚</p>
<p><img src="/media/15158218121366/numbers_2x.png" alt="Core Spotlight"></p>
<p>ä½¿ç”¨å‰éœ€è¦ import <code>Core Spotlight</code>ã€‚</p>
<h3 id="1ã€å»ºç«‹ç´¢å¼•"><a href="#1ã€å»ºç«‹ç´¢å¼•" class="headerlink" title="1ã€å»ºç«‹ç´¢å¼•"></a>1ã€å»ºç«‹ç´¢å¼•</h3><p>ç´¢å¼•å¯¹åº”çš„ç±»æ˜¯<code>CSSearchableItem</code>ã€‚å»ºç«‹ç´¢å¼•å‰ï¼Œè¦å…ˆåˆ›å»ºç´¢å¼•çš„å±æ€§é›†<code>CSSearchableItemAttributeSet</code>ã€‚</p>
<p><code>CSSearchableItemAttributeSet</code>ä¸­åŒ…å«äº†å¤§é‡çš„å±æ€§ï¼ŒåŒ…æ‹¬éŸ³è§†é¢‘ä¿¡æ¯ã€æ–‡ä»¶ä¿¡æ¯ã€å‡ºç‰ˆä¿¡æ¯ã€è”ç³»äººä¿¡æ¯ç­‰ç­‰ã€‚å®ä¾‹åŒ–å±æ€§é›†æ—¶ï¼Œå°±è¦æŒ‡å®šå±æ€§é›†çš„ç±»å‹ï¼Œå¦‚<code>kUTTypeImage</code>ï¼Œè¿™ä¼šå½±å“åˆ°ç´¢å¼•çš„æ˜¾ç¤ºæ ·å¼ã€‚è¿™äº›å¸¸é‡å£°æ˜äº<code>MobileCoreServices.UTCoreTypes</code>ä¸­ï¼Œå› æ­¤éœ€è¦ <strong>import</strong> è¿™ä¸ªå¤´æ–‡ä»¶ã€‚å±æ€§é›†ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å±æ€§ä¸º titleã€contentDescription å’Œ keywordsï¼Œtitle å°±æ˜¯ç´¢å¼•æ˜¾ç¤ºçš„æ ‡é¢˜ï¼ŒcontentDescription æ˜¯å¯¹å†…å®¹çš„æè¿°ï¼Œkeywords åˆ™æ˜¯ç´¢å¼•çš„å…³é”®è¯æ•°ç»„ï¼Œå®˜æ–¹å»ºè®®å…³é”®è¯ä¸º 5 ä¸ªå·¦å³ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtitle é»˜è®¤å°±èƒ½è¢«æœç´¢åˆ°ï¼Œä¸éœ€è¦åŠ å…¥ keywordsã€‚</p>
<p>è®¾ç½®å®Œç´¢å¼•çš„å±æ€§é›†ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡<code>CSSearchableItem</code>çš„<code>init(uniqueIdentifier: domainIdentifier: attributeSet:)</code>æ¥å®ä¾‹åŒ–ä¸€ä¸ªç´¢å¼•ã€‚å…¶ä¸­ï¼Œå‚æ•°<code>uniqueIdentifier</code>æ˜¯è¯¥ç´¢å¼•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è¯†ç¬¦æ¥åˆ é™¤è¿™æ¡ç´¢å¼•ï¼›<code>domainIdentifier</code>æ˜¯ç´¢å¼•æ‰€åœ¨çš„åŸŸåæ ‡è¯†ï¼ŒåŸŸåæ ‡è¯†å¯ä»¥ç”¨äºå°†ç´¢å¼•åˆ†ç±»å­˜æ”¾ï¼Œå¯ä»¥æ ¹æ®å®ƒæ¥åˆ é™¤åŒä¸€ä¸ª<code>domainIdentifier</code>ä¸‹çš„æ‰€æœ‰ç´¢å¼•ã€‚</p>
<p>æ¥ä¸‹æ¥ä¾¿æ˜¯å»ºç«‹ç´¢å¼•ã€‚å»ºç«‹ç´¢å¼•éœ€è¦è°ƒç”¨<code>CSSearchableIndex</code>å®ä¾‹çš„<code>indexSearchableItems()</code>æ–¹æ³•ã€‚å®ƒèƒ½å¤Ÿæ‰¹é‡å»ºç«‹ç´¢å¼•ï¼Œå¹¶æä¾›ä¸€ä¸ªå›è°ƒã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">createSearchIndex</span><span class="params">(with followers: [User])</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</div><div class="line">        <span class="keyword">var</span> searchableItems = [<span class="type">CSSearchableItem</span>]()</div><div class="line">        users.forEach &#123; (follower) <span class="keyword">in</span></div><div class="line">            <span class="comment">// ç´¢å¼•çš„å±æ€§é›†ï¼ˆåªç”¨äºæ§åˆ¶ç´¢å¼•åœ¨è¢«æœç´¢æ—¶çš„å±æ€§ï¼Œä¸èƒ½å­˜å‚¨æ•°æ®ï¼‰</span></div><div class="line">            <span class="keyword">let</span> attributeSet = <span class="type">CSSearchableItemAttributeSet</span>(itemContentType: kUTTypeImage <span class="keyword">as</span> <span class="type">String</span>)</div><div class="line">            <span class="comment">// ç´¢å¼•çš„æ ‡é¢˜ï¼ˆæ ‡é¢˜ä¹Ÿèƒ½è¢«æœç´¢åˆ°ï¼‰</span></div><div class="line">            attributeSet.title = follower.name</div><div class="line">            <span class="comment">// ç´¢å¼•çš„æè¿°</span></div><div class="line">            attributeSet.contentDescription = <span class="string">"æˆ‘çš„çˆ±è±†"</span></div><div class="line">            <span class="comment">// ç”¨äºå»ºç«‹ç´¢å¼•çš„å…³é”®è¯</span></div><div class="line">            attributeSet.keywords = [<span class="string">"punmy"</span>, <span class="string">"çˆ±è±†"</span>, follower.identifier]</div><div class="line">            <span class="comment">// Spotlight ç´¢å¼•çš„ç±»</span></div><div class="line">            <span class="keyword">let</span> searchableItem = <span class="type">CSSearchableItem</span>(uniqueIdentifier: <span class="string">"punmy://user?id=<span class="subst">\(follower.identifier)</span>"</span>, domainIdentifier: <span class="string">"com.meitu.yy.followers"</span>, attributeSet: attributeSet)</div><div class="line">            searchableItems.append(searchableItem)</div><div class="line">        &#125;</div><div class="line">        <span class="type">CSSearchableIndex</span>.<span class="keyword">default</span>().indexSearchableItems(searchableItems, completionHandler: &#123; (error) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</div><div class="line">                <span class="type">DDLogError</span>(<span class="string">"Create searchable index failed, error: <span class="subst">\(error.localizedDescription)</span>"</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">cleanSearchIndex</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</div><div class="line">    <span class="comment">// åˆ é™¤æ•´ä¸ªåŸŸåæ ‡è¯†ä¸‹çš„ç´¢å¼•</span></div><div class="line">        <span class="type">CSSearchableIndex</span>.<span class="keyword">default</span>().deleteSearchableItems(withDomainIdentifiers: [<span class="string">"com.punmy.followers"</span>]) &#123; (error) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="number">_</span> = error &#123;</div><div class="line">                <span class="type">DDLogError</span>(<span class="string">"delete searchable items failed, error: <span class="subst">\(error?.localizedDescription)</span>"</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è°ƒç”¨<code>indexSearchableItems()</code>æ–¹æ³•æˆåŠŸåï¼Œå°±èƒ½ç«‹å³åœ¨ Spotlight ä¸­æœç´¢åˆ°åˆšåˆšæ·»åŠ çš„ç´¢å¼•äº†ã€‚</p>
<p><img src="/media/15158218121366/QQ20170314-162924@2x.png" alt="Spotlight æœç´¢"></p>
<p>é€šè¿‡ <code>CSSearchableIndex</code> å®ä¾‹çš„å‡ ä¸ªåˆ é™¤æ–¹æ³•ï¼Œå°±èƒ½éƒ¨åˆ†ï¼Œæˆ–è€…å…¨éƒ¨åˆ é™¤ç´¢å¼•ã€‚</p>
<h3 id="2ã€å®ç°å›è°ƒ"><a href="#2ã€å®ç°å›è°ƒ" class="headerlink" title="2ã€å®ç°å›è°ƒ"></a>2ã€å®ç°å›è°ƒ</h3><p>è¦å¤„ç†ä»æœç´¢ç»“æœä¸­è¿›å…¥ App çš„å›è°ƒäº‹ä»¶ï¼Œéœ€è¦åœ¨ <strong>AppDelegate</strong> ä¸­å®ç°<code>application:continueUserActivity:restorationHandler:</code>æ–¹æ³•ã€‚è¿™ä¸ªå›è°ƒåœ¨è®¸å¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°ï¼Œå¦‚ Core Spotlightã€Siri Kitã€Handoff ç­‰ã€‚å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ä¸­ï¼Œåˆ©ç”¨ <code>userActivity</code> çš„ <code>userInfo</code> å­—å…¸ä¸­çš„æ•°æ®ï¼Œè·³è½¬åˆ°ç›¸åº”çš„é¡µé¢ã€‚</p>
<blockquote>
<p><strong>Note</strong>ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¹‹å‰æˆ‘ä»¬ä¸º<code>userActivity</code>æ‰€è®¾ç½®çš„å±æ€§é›†ï¼Œåœ¨è¿™é‡Œéƒ½ä¸å­˜åœ¨äº†ã€‚åªæœ‰ä¿å­˜åœ¨ <code>userInfo</code> ä¸­çš„æ•°æ®ï¼Œæ‰èƒ½åœ¨è¿™ä¸ªå›è°ƒä¸­è·å–åˆ°ã€‚</p>
</blockquote>
<p>ä¹‹å‰åˆ›å»º<code>CSSearchableItem</code>æ—¶ä¼ å…¥çš„<code>uniqueIdentifier</code>å‚æ•°ï¼Œåœ¨æ­¤å¤„å¯ä»¥é€šè¿‡ <code>userInfo</code> ä¸­çš„ <code>CSSearchableItemActivityIdentifier</code> keyå€¼è¯»å–åˆ°ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ä»£ç ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, <span class="keyword">continue</span> userActivity: NSUserActivity, restorationHandler: @escaping <span class="params">([Any]?)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> identifier = userActivity.userInfo?[<span class="type">CSSearchableItemActivityIdentifier</span>] <span class="keyword">as</span>? <span class="type">String</span> &#123;</div><div class="line">            <span class="comment">// è·³è½¬åˆ°å¯¹åº”é¡µé¢</span></div><div class="line">            restoreActivity(scheme: identifier)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šæ–‡æˆ‘ä»¬å·²ç»æåˆ°è¿‡ï¼Œæœ‰è®¸å¤šåŠŸèƒ½çš„å›è°ƒå…¥å£éƒ½æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚ä½•åŒºåˆ†ä¸åŒå…¥å£å‘¢ï¼Ÿ<br>ä¸€ç§åŠæ³•æ˜¯åƒä¸Šæ–¹ä»£ç ä¸€æ ·ï¼Œåˆ¤æ–­<code>userInfo</code>ä¸­æ˜¯å¦å­˜åœ¨ key ä¸º<code>CSSearchableItemActivityIdentifier</code>çš„å€¼ï¼›å¦ä¸€ç§åŠæ³•å¯ä»¥åˆ¤æ–­<code>userActivity</code>çš„ <code>activityType</code>å±æ€§çš„å€¼ï¼Œæ˜¯å¦ä¸º<code>CSSearchableItemActionType</code>ã€‚</p>
<p>åœ¨æŸäº›åŠŸèƒ½ä¸­ï¼ŒuserActivity çš„ <code>activityType</code> æ˜¯è®¾ç½®ä¸ºè‡ªå®šä¹‰åŸŸåçš„ï¼Œå¦‚ä¸‹é¢å°†ä¼šè®²åˆ° <strong>NSUserActivity</strong> éƒ¨åˆ†ã€‚ä½†åœ¨ Core Spotlight ä¸­ï¼Œæ‰€æœ‰çš„ç´¢å¼•çš„ç±»å‹éƒ½è¢«ç³»ç»Ÿè®¾ç½®ä¸º<code>CSSearchableItemActionType</code>ã€‚</p>
<h2 id="NSUserActivity"><a href="#NSUserActivity" class="headerlink" title="NSUserActivity"></a>NSUserActivity</h2><blockquote>
<p>Index Activities and Navigation Points</p>
</blockquote>
<p><strong>NSUserActivity</strong> ä¸»è¦ç”¨äºä¸ºç”¨æˆ·åœ¨ App ä¸­çš„<strong>å†å²æ´»åŠ¨</strong>å»ºç«‹ç´¢å¼•ã€‚NSUserActivity çš„ä½œç”¨æœ‰äº›ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„â€œå†å²è®°å½•â€ï¼Œåªæ˜¯è®°å½•çš„å†…å®¹æ˜¯ç”±æˆ‘ä»¬æ¥å†³å®šçš„ã€‚NSUserActivity å¯ä»¥é…åˆ Handoff ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨å…¶ä»–è®¾å¤‡ä¸Šç»§ç»­å½“å‰æ´»åŠ¨ï¼Œæœ‰å…³ Handoff å¯ä»¥å‚ç…§ï¼š<a href="https://code.tutsplus.com/tutorials/an-introduction-to-handoff--cms-24349" target="_blank" rel="external">Handoff ä»‹ç»</a>ã€‚</p>
<p><img src="/media/15158218121366/movie_2x.png" alt="å†å²æ´»åŠ¨"></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·ä½¿ç”¨ App çš„æ—¶å€™ï¼Œå°†ä»–æµè§ˆè¿‡çš„ä¸€äº›å…³é”®èŠ‚ç‚¹ï¼Œæˆ–æ˜¯é‡è¦çš„å†…å®¹é¡µé¢ï¼Œåœ¨ç³»ç»Ÿä¸­å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œä¿å­˜å¿…è¦çš„æ•°æ®ã€‚æ—¥åç”¨æˆ·åœ¨ Spotlight ç­‰åœ°æ–¹æœç´¢ç›¸å…³å†…å®¹æ—¶ï¼Œå°±èƒ½åœ¨æœç´¢ç»“æœä¸­æ˜¾ç¤ºè¯¥æ´»åŠ¨è®°å½•ï¼ˆUserActivityï¼‰ã€‚å½“ç”¨æˆ·ç‚¹å‡»è¯¥æœç´¢ç»“æœæ—¶ï¼Œç³»ç»Ÿä¼šè°ƒèµ· Appï¼Œå¹¶ä¼ å…¥ä¹‹å‰ä¿å­˜çš„æ•°æ®ï¼Œåº”ç”¨å°±èƒ½ä»¥æ­¤æ¥æ¢å¤ç°åœºã€‚</p>
<h3 id="1ã€å»ºç«‹ç´¢å¼•-1"><a href="#1ã€å»ºç«‹ç´¢å¼•-1" class="headerlink" title="1ã€å»ºç«‹ç´¢å¼•"></a>1ã€å»ºç«‹ç´¢å¼•</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·æµè§ˆåˆ°æŸäº›é¡µé¢çš„æ—¶å€™ï¼Œå°†è¯¥é¡µé¢åŠ å…¥ç³»ç»Ÿç´¢å¼•ã€‚ä¾‹å¦‚åœ¨ <code>viewDidLoadï¼ˆï¼‰</code>çš„æ—¶å€™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MARK: - Indexing activity</span></div><div class="line">    </div><div class="line"><span class="keyword">let</span> user</div><div class="line"><span class="keyword">var</span> activity? <span class="comment">// åŠ¡å¿…å¯¹ Activity è¿›è¡Œå¼ºå¼•ç”¨</span></div><div class="line">    </div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> activity = <span class="type">NSUserActivity</span>(activityType: <span class="string">"com.meitu.punmy.user"</span>)</div><div class="line">    <span class="comment">// ç´¢å¼•çš„æ ‡é¢˜</span></div><div class="line">    activity.title = user.name </div><div class="line">    <span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</div><div class="line">        <span class="comment">// ç´¢å¼•çš„å±æ€§é›†ï¼ˆåªå½±å“æœç´¢ç»“æœçš„æ˜¾ç¤ºæ ·å¼ï¼Œä¸èƒ½ç”¨äºå­˜å‚¨æ•°æ®ï¼‰</span></div><div class="line">        <span class="keyword">let</span> attributeSet = <span class="type">CSSearchableItemAttributeSet</span>(itemContentType: kUTTypeContact <span class="keyword">as</span> <span class="type">String</span>) </div><div class="line">        <span class="comment">// ç´¢å¼•çš„æè¿°</span></div><div class="line">        attributeSet.contentDescription = user.desc</div><div class="line">        <span class="comment">// èƒ½è¢«æœç´¢åˆ°çš„å…³é”®è¯ï¼ˆç´¢å¼•çš„æ ‡é¢˜ä¹Ÿèƒ½è¢«æœç´¢åˆ°ï¼‰</span></div><div class="line">        attributeSet.keywords = [user.identifier, <span class="string">"punmy"</span>]</div><div class="line">        <span class="comment">// ä¸é¡¹ç›®æœ¬èº«çš„ scheme æ­é…ä½¿ç”¨ï¼Œä¾¿äºè·³è½¬ </span></div><div class="line">        <span class="keyword">let</span> scheme = <span class="string">"punmy://user?id=<span class="subst">\(user.identifier)</span>"</span></div><div class="line">        <span class="comment">// å…³è”å·²æœ‰çš„ SpotLight Item</span></div><div class="line">        attributeSet.relatedUniqueIdentifier = scheme </div><div class="line">        </div><div class="line">        activity.contentAttributeSet = attributeSet</div><div class="line">        </div><div class="line">        <span class="comment">// åªæœ‰ userInfo ä¸­èƒ½å¤Ÿä¿å­˜æ•°æ®</span></div><div class="line">        activity.userInfo = [<span class="string">"scheme"</span>: scheme] </div><div class="line">        <span class="comment">// æ˜¯å¦å»ºç«‹ç´¢å¼•</span></div><div class="line">        activity.isEligibleForSearch = <span class="literal">true</span></div><div class="line">        <span class="comment">// æ˜¯å¦æ”¯æŒ Handoff åŠŸèƒ½</span></div><div class="line">        activity.isEligibleForHandoff = <span class="literal">false</span></div><div class="line">        <span class="comment">// ç´¢å¼•çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä¸€ä¸ªæœˆ</span></div><div class="line">        activity.expirationDate = <span class="type">Date</span>(timeIntervalSinceNow: <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æ¿€æ´» Activity</span></div><div class="line">    activity.becomeCurrent() </div><div class="line">    <span class="comment">// å¿…é¡»å¯¹ Activity è¿›è¡Œå¼ºå¼•ç”¨ï¼Œå¦åˆ™ Activity å¾ˆå¯èƒ½ä¸ä¼šè¢«åŠ å…¥ç´¢å¼•</span></div><div class="line">    <span class="keyword">self</span>.activity = activity</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¦å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å…ˆè¦åˆ›å»ºä¸€ä¸ª <strong>NSUserActivity</strong>å¯¹è±¡ï¼Œç”¨äºä¿å­˜å½“å‰é¡µé¢çš„ä¸€äº›å¿…è¦ä¿¡æ¯ï¼Œä»¥åŠè¦å»ºç«‹çš„ç´¢å¼•çš„ä¸€äº›å±æ€§ã€‚</p>
<p>åˆ›å»º NSUserActivity å¯¹è±¡æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªåˆå§‹åŒ–å‚æ•°<code>activityType</code>ï¼Œè¿™ä¸ª<code>activityType</code>ç±»ä¼¼äº Core Spotlight ä¸­çš„åŸŸåæ ‡è¯†ï¼Œåªæ˜¯ä½œç”¨ä¸Šæœ‰äº›åŒºåˆ«ã€‚åœ¨ Spotlight ç­‰å…¥å£ï¼Œæœç´¢ç»“æœè¢«ç‚¹å‡»æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ ‡è¯†ï¼Œå»åŒºåˆ†ç”±å“ªä¸ªåº”ç”¨æ¥æ¢å¤è¿™ä¸ªæ´»åŠ¨ã€‚åœ¨è¿›å…¥åº”ç”¨åï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿåœ¨å›è°ƒä¸­ï¼Œåˆ©ç”¨è¿™ä¸ªå±æ€§æ¥åŒºåˆ†æ´»åŠ¨ã€‚</p>
<p>ä¸ºäº†è®©ç³»ç»ŸçŸ¥é“æˆ‘ä»¬çš„åº”ç”¨èƒ½å¤„ç†å“ªäº› activityTypeï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨ Info.plist ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>NSUserActivityTypes</code>çš„ String æ•°ç»„ï¼Œæ ‡è¯†å‡ºæ‰€æœ‰æˆ‘ä»¬çš„åº”ç”¨èƒ½å¤Ÿå¤„ç†çš„ activityTypeã€‚</p>
<p>é€šè¿‡è®¾ç½® <code>NSUserActivity</code>çš„<code>contentAttributeSet</code>å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç´¢å¼•åœ¨æœç´¢ç»“æœä¸­çš„æ ·å¼ã€‚è®¾ç½®ç»™<code>contentAttributeSet</code>å±æ€§çš„æ˜¯ä¸€ä¸ª<code>CSSearchableItemAttributeSet</code>å®ä¾‹ï¼Œä¸ Core Spotlight ä¸­çš„å±æ€§é›†ç›¸ä¼¼ï¼Œå®ƒåŒ…å«å¤§é‡çš„å±æ€§å¯ä»¥è®¾ç½®ã€‚</p>
<blockquote>
<p><strong>Note</strong>ï¼šActivity åœ¨è°ƒç”¨äº† <code>becomeCurrent()</code> æ–¹æ³•æ¿€æ´»åï¼Œå¿…é¡»å¯¹ Activity è¿›è¡Œå¼ºå¼•ç”¨ï¼Œé˜²æ­¢å®ƒ dealloc äº†ï¼Œå¦åˆ™ Activity å¾ˆå¯èƒ½ä¸ä¼šè¢«åŠ å…¥ç´¢å¼•ã€‚ç›¸å…³è®¨è®ºè§ Apple è®ºå›ï¼š<a href="https://forums.developer.apple.com/message/13640#13640" target="_blank" rel="external">Search APIs are working</a></p>
</blockquote>
<h3 id="2ã€å®ç°å›è°ƒ-1"><a href="#2ã€å®ç°å›è°ƒ-1" class="headerlink" title="2ã€å®ç°å›è°ƒ"></a>2ã€å®ç°å›è°ƒ</h3><p><strong>NSUserActivity</strong> çš„å›è°ƒå…¥å£ä¸ <strong>Core Spotlight</strong> çš„å¾ˆç›¸ä¼¼ã€‚åŒæ ·åœ¨<code>AppDelegate</code>ä¸­å®ç°<code>application:continueUserActivity:restorationHandler:</code>æ–¹æ³•ï¼Œåƒä¸Šé¢è¯´åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>userActivity</code> çš„ <code>activityType</code> å±æ€§æ¥åŒºåˆ†æ´»åŠ¨ç±»å‹ã€‚æ­¤æ—¶<code>userActivity</code>çš„å±æ€§é›†ä¹Ÿå·²ç»ä¸ºç©ºï¼Œåªèƒ½è®¿é—®åˆ° <code>userInfo</code> ä¸­çš„æ•°æ®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(UIApplication, continueUserActivity userActivity: NSUserActivity, restorationHandler: [AnyObject]? -&gt; Void)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">if</span> userActivity.activityType == <span class="string">"com.meitu.punmy.user"</span> &#123;</div><div class="line">        <span class="comment">// Restore app state for this userActivity and associated userInfo value.</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Web-markup"><a href="#Web-markup" class="headerlink" title="Web markup"></a>Web markup</h2><blockquote>
<p>Engage Web Content</p>
</blockquote>
<p>ç”±äºæœ¬æ¬¡åˆ†äº«çš„ä¸»è¦é’ˆå¯¹ Core Spotlight å’Œ NSActivityï¼ŒWeb markup å°±åªä½œç®€è¦ä»‹ç»ã€‚</p>
<p>Web Markupå…è®¸åº”ç”¨å°†å®ƒä»¬çš„å†…å®¹æ˜ å°„åˆ°ä¸€ä¸ªç½‘ç«™ï¼ˆå¦‚ç½‘é¡µç‰ˆç¾æ‹ï¼‰ï¼Œä»è€Œåœ¨ Spotlight æˆ– Safari ä¸­è¿›è¡Œæœç´¢ï¼Œå³ä½¿ç”¨æˆ·æ²¡æœ‰å®‰è£…ç›¸å…³åº”ç”¨ã€‚ç”¨æˆ·ç‚¹å‡»ç›¸å…³ç»“æœåï¼Œå¦‚æœæ²¡æœ‰å®‰è£…åº”ç”¨ï¼Œåˆ™é€šè¿‡ Safari æ‰“å¼€ï¼Œå¦‚æœå·²ç»å®‰è£…åº”ç”¨ï¼Œåˆ™è·³è½¬åˆ°å¯¹åº”é¡µé¢ã€‚</p>
<p>è‹¹æœæœ‰ç±»ä¼¼äºæœç´¢å¼•æ“çˆ¬è™«çš„æœºå™¨äººï¼Œèƒ½å¤ŸæŠ“å–æ”¯æŒ Web markup çš„ç½‘ç«™æ¥è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼ˆéœ€è¦åå°é…ç½®ï¼Œå¹¶ç»“åˆ Universal Link ä½¿ç”¨ï¼‰ã€‚æŠ“å–ç»“æœä¼šå‚¨å­˜åœ¨è‹¹æœçš„äº‘ç´¢å¼•æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ Safari å’Œ Spotlight æä¾›ç»™ç”¨æˆ·ã€‚</p>
<p>æœ‰å…³ Web markup çš„è¯¦ç»†å†…å®¹å¯ä»¥è®¿é—®å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/WebContent.html" target="_blank" rel="external">Mark Up Web Content</a></p>
<h2 id="è”åˆä½¿ç”¨-Core-Spotlight-å’Œ-NSUserActivity"><a href="#è”åˆä½¿ç”¨-Core-Spotlight-å’Œ-NSUserActivity" class="headerlink" title="è”åˆä½¿ç”¨ Core Spotlight å’Œ NSUserActivity"></a>è”åˆä½¿ç”¨ Core Spotlight å’Œ NSUserActivity</h2><p>è‹¹æœåœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¡¨ç¤ºï¼Œä¸‰å¤§æœç´¢ API æ˜¯ä¸ºäº†è”åˆä½¿ç”¨è€Œè®¾è®¡çš„ï¼Œæ··åˆä½¿ç”¨å¤šç§ API æœ‰åŠ©äºæå‡æœç´¢çš„è¦†ç›–ç‡ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ··åˆä½¿ç”¨å¤šç§ API ä¼šæœ‰ä¸€äº›å‘ï¼Œä¸‹é¢å¤§è‡´è®²ä¸€ä¸‹ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚</p>
<p>###1ã€å”¯ä¸€æ ‡è¯†çš„ä½¿ç”¨###<br>Core Spotlight ä¸­çš„ <code>uniqueIdentifier</code>ï¼ŒNSUserActivity ä¸­çš„ <code>relatedUniqueIdentifier</code> å±æ€§ï¼Œä»¥åŠ Web markup ä¸­çš„ <code>webpageURL</code>ï¼Œéƒ½ä¼šè¢«ç³»ç»Ÿç”¨äºç´¢å¼•çš„<strong>å…³è”</strong>ã€‚ä½†ç³»ç»Ÿä¸ä¼šå¹³ç­‰åœ°å¤„ç†è¿™å‡ ä¸ªä¸œè¥¿ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åˆ†åˆ«é€šè¿‡ Core Spotlight å’Œ NSActivity ç”Ÿæˆäº†ä¸¤ä¸ªç›¸åŒæ ‡è¯†çš„ç´¢å¼•/æ´»åŠ¨ï¼Œé‚£ä¹ˆåœ¨ Spotlight ä¸­æœç´¢åˆ°çš„åªä¼šæ˜¯é€šè¿‡ Core Spotlight è®¾ç½®çš„ç´¢å¼•ï¼›è€Œ NSActivity ç”Ÿæˆçš„ç´¢å¼•ï¼Œåˆ™æ˜¯ç”¨äº Siri Kitï¼ˆå¦‚æœä½ æœ‰ä½¿ç”¨ Siri Kit çš„è¯ï¼‰ã€‚</p>
<p>###2ã€ç´¢å¼•çš„æ›´æ–°å’Œåˆ é™¤###<br>é€šè¿‡ Core Spotlight å»ºç«‹çš„ç´¢å¼•ï¼Œå¯ä»¥é€šè¿‡ CSSearchableIndex å®ä¾‹çš„ä¸‰ä¸ªåˆ é™¤æ–¹æ³•è¿›è¡Œåˆ é™¤ã€‚ä¹Ÿå¯ä»¥è®¾ç½®<strong>è¿‡æœŸæ—¶é—´</strong>ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨æ¸…é™¤ã€‚é»˜è®¤çš„è¿‡æœŸæ—¶é—´ä¸ºä¸€ä¸ªæœˆã€‚<br>è€Œé€šè¿‡ NSActivity ç”Ÿæˆçš„ç´¢å¼•ï¼Œåªèƒ½è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç”±ç³»ç»Ÿç®¡ç†ï¼Œæ— æ³•æ‰‹åŠ¨åˆ é™¤ã€‚</p>
<p>è¦æ›´æ–°ç›¸åŒ API å»ºç«‹çš„ç´¢å¼•ï¼Œåªéœ€è¦å†å»ºç«‹ä¸€ä¸ªç›¸åŒ identifier çš„ç´¢å¼•æˆ–è€…æ´»åŠ¨ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ›´æ–°å¯¹åº”ç´¢å¼•ã€‚ä½†æ˜¯ï¼Œä¸åŒ API ç”Ÿæˆçš„ç´¢å¼•ï¼Œå³ä½¿ identifier ç›¸åŒï¼Œä¹Ÿä¸ä¼šç›¸äº’æ›´æ–°å†…å®¹ã€‚</p>
<p>###3ã€æœç´¢æ’åº###<br>è‹¹æœå¯¹äºæœç´¢çš„æ’åºä¸»è¦ä¾æ®ä»¥ä¸‹å‡ ä¸ªç»´åº¦ï¼š</p>
<ul>
<li>ç”¨æˆ·æµè§ˆ App ä¸­å†…å®¹çš„é¢‘ç‡ (å½“æˆ‘ä»¬è°ƒç”¨ NSUserActivity çš„<code>becomeCurrent()</code>æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šè¿›è¡Œç»Ÿè®¡)</li>
<li>ç”¨æˆ·å¯¹äºåº”ç”¨ä¸­çš„å†…å®¹çš„å‚ä¸åº¦ï¼ˆç”±â€œäº’åŠ¨ç‡â€å†³å®šã€‚â€œäº’åŠ¨ç‡â€æ˜¯åŸºäºä¸¤ä¸ªæ•°æ®è®¡ç®—çš„ï¼Œåˆ†åˆ«æ˜¯ï¼šç”¨æˆ·ç‚¹å‡»ä¸ä½ åº”ç”¨ç›¸å…³çš„æ¡ç›®çš„æ¬¡æ•°ï¼Œä»¥åŠæœç´¢ç»“æœä¸­æ˜¾ç¤ºçš„åº”ç”¨ç›¸å…³çš„æ¡ç›®çš„æ•°é‡ï¼‰</li>
<li>ä½ çš„ç½‘ç«™ä¸­æŸä¸ªç½‘å€çš„å—æ¬¢è¿ç¨‹åº¦ï¼Œä»¥åŠå¯ç”¨çš„ç»“æ„åŒ–æ•°æ®é‡ã€‚ï¼ˆWeb markupï¼‰</li>
</ul>
<p>åŠé—´ä¼ é—»ï¼Œè‹¹æœä¸ºäº†é˜²æ­¢ä¸–ç•Œè¢«ç ´åï¼Œå®ˆæŠ¤ iOS çš„ç”Ÿæ€åœˆï¼Œåœ¨æœç´¢ç»“æœçš„æ’åºä¸Šï¼ŒèŠ±è´¹äº†é‡é‡‘è¿›è¡Œä¼˜åŒ–ã€‚æ²¡æœ‰å¥½å¥½ç»´æŠ¤ iOS ç”Ÿæ€åœˆçš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨çš„ç´¢å¼•è¢«é™ä½æ’åï¼Œæˆ–æ˜¯è¢«è¸¢å‡ºæœç´¢ç»“æœã€‚å› æ­¤åœ¨ä½¿ç”¨æœç´¢ API æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li>é˜²æ­¢è¿‡åº¦ç´¢å¼•ï¼›ï¼ˆä¸è¦æŠŠä¸€å¤§å †æœ‰çš„æ²¡çš„æ•°æ®ï¼Œéƒ½ä¸¢åˆ°ç³»ç»Ÿç´¢å¼•ä¸­å»ï¼‰</li>
<li>å°½å¿«å°†ç”¨æˆ·å¸¦å…¥å†…å®¹é¡µï¼›ï¼ˆé¿å…ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠé™ä½ App å¯åŠ¨æ—¶é—´ï¼‰</li>
<li>å¦‚æœåˆ›å»ºçš„ NSUserActivity ä¸å·²æœ‰çš„ Core Spotlight ç´¢å¼•ç›¸åŒï¼Œé‚£ä¹ˆå°±å°†å®ƒä»¬ç”¨ç›¸åŒçš„ identifier å…³è”èµ·æ¥ï¼Œè¿™æ ·æ¯æ¬¡æ¿€æ´» NSUserActivity æ—¶ï¼Œä¹Ÿèƒ½æå‡ Core Spotlight ç´¢å¼•çš„æ’åï¼›</li>
</ol>
<p><img src="/media/15158218121366/apple.png" alt="å»¶è¿Ÿè¿›å…¥å†…å®¹é¡µ"></p>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>ä½¿ç”¨ Search APIs å¯ä»¥æœ‰æ•ˆæå‡åº”ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œä½†è¦æ³¨æ„å„ç§ API çš„é€‚ç”¨åœºæ™¯ï¼ŒåŒæ—¶ç»´æŠ¤å¥½ iOS çš„ç”Ÿæ€åœˆã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/" target="_blank" rel="external">App Search Programming Guide</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://punmy.cn/2017/03/06/15158218121366/" data-id="cjfpn3ybr0008sto11pi7r1cy" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://punmy.cn/2017/03/06/15158218121366/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://punmy.cn/2017/03/06/15158218121366/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/08/04/15018607710939/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    äº”åˆ†é’Ÿé‡æ‹¾æ­£åˆ™è¡¨è¾¾å¼
                
            </div>
        </a>
    
    
        <a href="/2016/10/06/14757432517519/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">OSX/iOS ç½‘ç»œæŠ“åŒ…å·¥å…· Charles å…¥é—¨</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Code/">Code</a></p>
                            <p class="item-title"><a href="/2017/08/31/15041894895980/" class="title">HTTP/2 åˆæ¢</a></p>
                            <p class="item-date"><time datetime="2017-08-31T14:24:00.000Z" itemprop="datePublished">2017-08-31</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Code/">Code</a></p>
                            <p class="item-title"><a href="/2017/08/04/15018607710939/" class="title">äº”åˆ†é’Ÿé‡æ‹¾æ­£åˆ™è¡¨è¾¾å¼</a></p>
                            <p class="item-date"><time datetime="2017-08-04T15:01:00.000Z" itemprop="datePublished">2017-08-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Code/">Code</a></p>
                            <p class="item-title"><a href="/2017/03/06/15158218121366/" class="title">iOS Search APIs</a></p>
                            <p class="item-date"><time datetime="2017-03-06T08:40:00.000Z" itemprop="datePublished">2017-03-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/å·¥å…·/">å·¥å…·</a></p>
                            <p class="item-title"><a href="/2016/10/06/14757432517519/" class="title">OSX/iOS ç½‘ç»œæŠ“åŒ…å·¥å…· Charles å…¥é—¨</a></p>
                            <p class="item-date"><time datetime="2016-10-06T08:40:00.000Z" itemprop="datePublished">2016-10-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Code/">Code</a></p>
                            <p class="item-title"><a href="/2016/07/28/15231176397746/" class="title">å¿ƒè·³ä¹‹æ—…â€”ğŸ’—â€”iOSç”¨æ‰‹æœºæ‘„åƒå¤´æ£€æµ‹å¿ƒç‡(PPG)</a></p>
                            <p class="item-date"><time datetime="2016-07-28T12:56:00.000Z" itemprop="datePublished">2016-07-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/å·¥å…·/">å·¥å…·</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Article/" style="font-size: 10px;">Article</a> <a href="/tags/Camera/" style="font-size: 10px;">Camera</a> <a href="/tags/HTTP2/" style="font-size: 10px;">HTTP2</a> <a href="/tags/framework/" style="font-size: 10px;">framework</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/åŸºç¡€/" style="font-size: 15px;">åŸºç¡€</a> <a href="/tags/å·¥å…·/" style="font-size: 10px;">å·¥å…·</a> <a href="/tags/æŠ€èƒ½/" style="font-size: 10px;">æŠ€èƒ½</a> <a href="/tags/æ­£åˆ™è¡¨è¾¾å¼/" style="font-size: 10px;">æ­£åˆ™è¡¨è¾¾å¼</a> <a href="/tags/ç½‘ç»œ/" style="font-size: 15px;">ç½‘ç»œ</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Nico<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'http://punmy.cn/2017/03/06/15158218121366/';
        
        this.page.identifier = '15158218121366';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'punmy' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
    <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>